<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="UTF-8">
    <title>JavaScript Exploit Demo</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <script src="js/jquery.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>

    <!-- HighlightJS -->
    <link rel="stylesheet" href="css/atom-one-light.css">
    <script src="js/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <style>
        @font-face {
            font-family: 'Roboto';
            src: url('fonts/Roboto-Regular.ttf');
        }
        body{
            background-color: #E9E9E9;
        }
        .content{
            background-color: white;
            max-width: 1000px;
            margin-top: 1.5rem;
            padding: 2rem 1.5rem 1.5rem;
            box-shadow: 5px 0 15px -4px rgb(204 204 204), -5px 0 8px -4px rgb(204 204 204);
            font-family: Roboto, sans-serif;
        }
        .github{
            position: absolute;
            right: 0;
            top: 0;
        }
        .code{
            background-color: white;
        }
        .answer{
            padding: .5rem;
            margin-left: .5rem;
            margin-right: 1.5rem;
        }

    </style>



</head>
<body>

<!-- Fork me on github -->
<a class="github" href="https://github.com/jrghndl/Javascript-Exploit">
    <img src="images/fork.png" height="149" width="149"/>
</a>

<!-- Content -->
<div class="content mx-auto border border-1">
    <h2>JavaScipt Exploit Demo</h2>
    <hr>
    <p>Scenario: A website uses an obfuscated anonymous javascript to protect data from being modified by the client.
       The form below will determine whether the client as modified the data.</p>

    <br />

    <div>
        <label>Has data been changed? <label id="answer" class="border answer">False</label></label>
        <button id="button" type="button" class="btn btn-primary">Try Again</button>
    </div>

    <div style="padding-top: 2.5rem; padding-bottom: 2rem;">
        To modify the data, use the developer console to execute the exploit code. Then, press the 'Try Again' button.
    </div>




    <!-- Tabs navs -->
    <ul class="nav nav-tabs" id="codeTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <a class="nav-link active" data-toggle="tab" href="#exploit">Exploit Code</a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link" data-toggle="tab" href="#obfuscated">Obfuscated Code</a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link" data-toggle="tab" href="#unobfuscated">Unobfuscated Code</a>
        </li>
    </ul>

    <!-- Tabs content -->
    <div class="tab-content">
        <div id="exploit" class="container tab-pane active"><br>
            <pre><code class="javascript code">    (function() {
        String.prototype.oldSlice = String.prototype.slice;
        String.prototype.slice = function(start, end) {
            //This page uses jquery functions that use String.prototype.slice and will throw an error. If the string isn't the one,
            //we're targeting, then its passed to the old slice function so that everything can function as originally intended.
            try {
                //We use a signature from the target function so that we only modify the results of the target function.
                //The target function has a unique character pattern that we can search for ("[''](,);"), which we can use to guarantee
                //which function we're targeting.
                if (arguments.callee.caller.toString().replace(/[a-zA-Z0-9_ ]/g, '').includes("[''](,);")) {
                    console.log(arguments.callee.caller.name);
                    console.log(arguments.callee.caller.arguments);
                    console.log(arguments.callee.caller.prototype);
                    console.log(arguments.callee.caller.toString());
                    //Calls the old slice function with modified arguments so that we can modify the data.
                    //Another option is to simply return True.
                    return arguments.callee.caller.arguments[0].oldSlice(0, 4);
                } else {
                    return this.oldSlice(start, end);
                }
            } catch (err) {
                return this.oldSlice(start, end);
            }
        }
    })();
            </code></pre>
        </div>
        <div id="obfuscated" class="container tab-pane fade"><br>
            <pre><code class="javascript code">    //Obfuscated using https://obfuscator.io/
    (function () {
        var _0xf54e = ['innerText', '11HBPCbQ', 'onclick', 'getElementById', '3743Uvulxf', '12nXQUbp', '36757ptBYYB', 'answer', '13121GRHSVy', '31CEFhkt', '38309PnhIJV', '62299iFVhOW', '413411EjClEQ', 'button', 'True\x20or\x20False', '427859kHJxAX', '14ymGpHz'];
        var _0x1d4c = function(_0x251bd4, _0x2fd006) {
            _0x251bd4 = _0x251bd4 - 0x162;
            var _0xf54ef2 = _0xf54e[_0x251bd4];
            return _0xf54ef2;
        };
        (function(_0x28f2a3, _0x460c27) {
            var _0x151665 = _0x1d4c;
            while (!![]) {
                try {
                    var _0x10edb5 = -parseInt(_0x151665(0x166)) * -parseInt(_0x151665(0x172)) + -parseInt(_0x151665(0x168)) + -parseInt(_0x151665(0x167)) * -parseInt(_0x151665(0x162)) + parseInt(_0x151665(0x16d)) * parseInt(_0x151665(0x163)) + -parseInt(_0x151665(0x16f)) * -parseInt(_0x151665(0x165)) + -parseInt(_0x151665(0x169)) + -parseInt(_0x151665(0x16c));
                    if (_0x10edb5 === _0x460c27) break;
                    else _0x28f2a3['push'](_0x28f2a3['shift']());
                } catch (_0x20e6f7) {
                    _0x28f2a3['push'](_0x28f2a3['shift']());
                }
            }
        }(_0xf54e, 0x50d5d), function() {
            var _0xbcd03e = _0x1d4c,
                _0x401aad = document[_0xbcd03e(0x171)](_0xbcd03e(0x16a)),
                _0x2bdd62 = document['getElementById'](_0xbcd03e(0x164));
            _0x401aad[_0xbcd03e(0x170)] = function() {
                var _0x544fdf = _0xbcd03e;
                _0x2bdd62[_0x544fdf(0x16e)] = _0x5f378e(_0x544fdf(0x16b), 0x8, 0xd);
            };

            function _0x5f378e(_0x52d246, _0x167d5f, _0x2a1495) {
                return _0x52d246['slice'](_0x167d5f, _0x2a1495);
            }
        }());
    })();
            </code></pre>
        </div>
        <div id="unobfuscated" class="container tab-pane fade"><br>
            <pre><code class="javascript code">    (function () {
        var button = document.getElementById("button");
        var answer = document.getElementById("answer");

        button.onclick = function(){
            answer.innerText = getResult("True or False", 8, 13);
        };

        function getResult(str, start, end){
            return str.slice(start, end);
        }
    })();
            </code></pre>
        </div>
    </div>

    <p>Works as of Chrome Version 88.0.4324.150 </p>

<script>
    (function () {
        var _0xf54e = ['innerText', '11HBPCbQ', 'onclick', 'getElementById', '3743Uvulxf', '12nXQUbp', '36757ptBYYB', 'answer', '13121GRHSVy', '31CEFhkt', '38309PnhIJV', '62299iFVhOW', '413411EjClEQ', 'button', 'True\x20or\x20False', '427859kHJxAX', '14ymGpHz'];
        var _0x1d4c = function(_0x251bd4, _0x2fd006) {
            _0x251bd4 = _0x251bd4 - 0x162;
            var _0xf54ef2 = _0xf54e[_0x251bd4];
            return _0xf54ef2;
        };
        (function(_0x28f2a3, _0x460c27) {
            var _0x151665 = _0x1d4c;
            while (!![]) {
                try {
                    var _0x10edb5 = -parseInt(_0x151665(0x166)) * -parseInt(_0x151665(0x172)) + -parseInt(_0x151665(0x168)) + -parseInt(_0x151665(0x167)) * -parseInt(_0x151665(0x162)) + parseInt(_0x151665(0x16d)) * parseInt(_0x151665(0x163)) + -parseInt(_0x151665(0x16f)) * -parseInt(_0x151665(0x165)) + -parseInt(_0x151665(0x169)) + -parseInt(_0x151665(0x16c));
                    if (_0x10edb5 === _0x460c27) break;
                    else _0x28f2a3['push'](_0x28f2a3['shift']());
                } catch (_0x20e6f7) {
                    _0x28f2a3['push'](_0x28f2a3['shift']());
                }
            }
        }(_0xf54e, 0x50d5d), function() {
            var _0xbcd03e = _0x1d4c,
                _0x401aad = document[_0xbcd03e(0x171)](_0xbcd03e(0x16a)),
                _0x2bdd62 = document['getElementById'](_0xbcd03e(0x164));
            _0x401aad[_0xbcd03e(0x170)] = function() {
                var _0x544fdf = _0xbcd03e;
                _0x2bdd62[_0x544fdf(0x16e)] = _0x5f378e(_0x544fdf(0x16b), 0x8, 0xd);
            };

            function _0x5f378e(_0x52d246, _0x167d5f, _0x2a1495) {
                return _0x52d246['slice'](_0x167d5f, _0x2a1495);
            }
        }());
    })();


</script>




</body>
</html>