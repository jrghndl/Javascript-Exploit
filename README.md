
# Javascript Exploit
A method for exploiting vulnerabilities in JavaScript code that allows the user to modify obfuscated self-invoking Javascript functions.

All of the code used here is working as of Google Chrome Version 84.0.4147.135.
## Description
In an attempt to secure client side Javascript code, developers often use obfuscated anonymous self-invoking functions. Anonymous self-invoking functions do not have a name, the result of which is that it hides its contents from other Javascript code. 

Example:

    (function () {
        let x = "Hello World!"
    }());
Outside of the function, you cannot access the variable x. Paired with obfuscation, this makes it difficult for an outside actor to manipulate a protected client code. However, this is not the case.

While it's true that you cannot directly access anonymous functions, there is a way to get around this limitation. Its more than likely that such code will call a native Javascript function at some point. If you read the obfuscated code, you should be able to figure out what native functions it uses. 

Once you have your target native function, create a variable and let it be equal to the prototype of that native function. You can then modify the prototype of the native function. This will be your entry point into the anonymous function. At the end of the modified prototype, you can have it call the old prototype and return whatever it normally would so that the modification doesn't interrupt the flow. In the modified prototype, you can use the following to get the caller and information related to it:

    arguments.callee.caller.arguments
    arguments.callee.caller.name
    arguments.callee.caller.prototype
    arguments.callee.caller.toString()

If a function within the anonymous function calls the modified native function, the lines about will give you considerable power over those functions. There may be multiple functions that call the same native function, so in order to figure out which does what, you'll need to piece it together through its obfuscated code and through its arguments. 

If you use obfuscated anonymous self-invoking functions to protect your code, then it is vulnerable to attack.

## Example
The following example demonstrates the results from using the above method on a multiplayer HTML5 game. The game's javascript is obfuscated each time that a client loads it, meaning functions are different each time.

Refer to Exploit.js for the code used for the exploit. Refer to TargetFunction.js for the obfuscated code of the target's function that was inside the anonymous self-invoking function. 

The game has a camera feature that allows the user to take photos in the game. They then get uploaded to the user's album. The user can then share those photos with other users in game. The code in Exploit.js intercepts the photo taken in game and replaces it with any desired image. The exploit uses a simple user interface with a switch to turn it on or off and a button for selecting an image from the user's computer. See the interface below.

![Exploit UI](https://github.com/jrghndl/Javascript-Exploit/raw/master/ui.png)

When it's on, whenever the in game camera feature is used, it replaces the image with whatever the user desires. The two pictures below show before and after a picture is taken with the in game camera. The camera is originally focused on a dragon in the background. When the picture is taken, it is replaced with the image seen in the UI above.

Before

![Before](https://github.com/jrghndl/Javascript-Exploit/raw/master/original.png)

After

![After](https://github.com/jrghndl/Javascript-Exploit/raw/master/result.png)

This feature was presumed to be a safe method for users to share pictures taken in game with one another. However, considering that any image can be uploaded, this poses a risk to the safety of users.
### Disclaimer
This code is only meant for educational purposes. Please do not use it for anything malicious. We're not responsibly for any use of this information outside of its intended purposes.
The developer for this game has been informed of this exploit.
